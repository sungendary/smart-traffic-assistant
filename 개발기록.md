# 개발 기록

## Index
1. [2025-11-03] LLM 비동기 처리 및 작업 상태 API 도입
2. [2025-11-03] 프론트엔드 UX 개선 및 로그인 상태 복원 강화
3. [2025-11-03] Redis 기반 JWT 세션 관리 고도화

---

### 2025-11-03 - LLM 비동기 처리 및 작업 상태 API 도입
- LangChain 호출을 Redis 작업큐로 분리하여 `/api/map/suggestions`가 즉시 응답하고, `llm_task_id`를 통해 폴링하도록 변경 (`backend/app/services/llm_tasks.py`, `backend/app/services/map.py`).
- 새로운 AI 작업 상태 엔드포인트 `/api/ai/tasks/{task_id}` 추가 (`backend/app/api/routes/ai.py`) 및 응답 스키마 확장 (`backend/app/schemas/ai.py`, `backend/app/schemas/map.py`).
- `ChatOllama` 서브클래스 도입으로 지원되지 않는 옵션 제거, Ollama 로그 경고 해결 (`backend/app/services/llm.py`).
- 프런트엔드 우측 패널에서 작업 진행/실패/완료 상태를 표시하고 폴링 로직 구현 (`frontend/app.js`, `frontend/styles.css`).
- API 문서/README에 비동기 작업 흐름과 경량 모델 사용법 갱신 (`APIendpoint.md`, `README.md`).

### 2025-11-03 - 프론트엔드 UX 개선 및 로그인 상태 복원 강화
- 로그인 직후 즉시 화면이 갱신되도록 렌더 순서를 조정하고, 백그라운드 데이터 로딩 중 상태 메시지를 표시 (`frontend/app.js`).
- 새로고침 시 로그아웃으로 보이던 문제 해결: 맵 초기화 직후 렌더링하고, 이후 백엔드와 동기화 (`frontend/app.js`).
- Access 토큰은 메모리에만 유지하고 HttpOnly Refresh 쿠키로 세션을 복원하도록 silent refresh 로직 도입 (`frontend/app.js`).
- 좌/우 사이드바에 커스텀 스크롤과 그라디언트를 적용하여 가독성과 디자인 개선 (`frontend/styles.css`).

### 2025-11-03 - Redis 기반 JWT 세션 관리 고도화
- 로그인/리프레시/로그아웃 흐름에 `session_id`를 도입하고 Redis에 세션 메타데이터 저장 (`backend/app/services/sessions.py`, `backend/app/api/routes/auth.py`).
- Access/Refresh 토큰마다 JTI·세션 정보를 검증하고, 토큰 회전 시 Redis 키와 세션 레코드를 갱신 (`backend/app/core/auth.py`, `backend/app/api/routes/auth.py`).
- 활성 세션 조회 및 강제 로그아웃 API 추가 (`GET/DELETE /api/auth/sessions`), 응답 스키마 정의 (`backend/app/schemas/sessions.py`, `APIendpoint.md`).
- 로그아웃 시 Redis 세션을 즉시 폐기하고 마지막 접속 정보(IP/User-Agent)를 업데이트하여 추적 가능성 강화 (`backend/app/api/routes/auth.py`).
