# API Endpoints

ì´ ë¬¸ì„œëŠ” FastAPI ë°±ì—”ë“œì—ì„œ ì œê³µí•˜ëŠ” REST APIë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤. ëª¨ë“  ê²½ë¡œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `settings.api_prefix`(`/api`)ë¥¼ ì ‘ë‘ì‚¬ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¸ì¦ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ëŠ” `Authorization: Bearer <access_token>` í—¤ë”ë¥¼ ìš”êµ¬í•˜ë©°, ë¡œê·¸ì¸ ì‹œ ë°œê¸‰ë˜ëŠ” Refresh í† í°ì€ httpOnly ì¿ í‚¤ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

---

## 1. í—¬ìŠ¤ì²´í¬
| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/health` | í•„ìš” ì—†ìŒ | ì„œë²„ ìƒíƒœ í™•ì¸ (`{"status": "ok"}`) |

## 2. í™˜ê²½ ì„¤ì •
| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/config/maps` | í•„ìš” ì—†ìŒ | Kakao Maps JavaScript í‚¤ ì¡°íšŒ |

---

## 3. ì¸ì¦(Auth)
ê¸°ë³¸ ê²½ë¡œ: `/api/auth`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| POST | `/api/auth/signup` | í•„ìš” ì—†ìŒ | ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ íšŒì›ê°€ì… |
| POST | `/api/auth/login` | í•„ìš” ì—†ìŒ | ë¡œê·¸ì¸ ë° Access/Refresh í† í° ë°œê¸‰ |
| POST | `/api/auth/refresh` | í•„ìš” ì—†ìŒ (Refresh ì¿ í‚¤ í•„ìš”) | ìƒˆ Access í† í° ë°œê¸‰ |
| POST | `/api/auth/logout` | í•„ìš” ì—†ìŒ | Refresh í† í° ì‚­ì œ ë° ë¡œê·¸ì•„ì›ƒ |

**íšŒì›ê°€ì… ìš”ì²­ ì˜ˆì‹œ**
```json
{
  "email": "user@example.com",
  "nickname": "ë‚˜ë¹„",
  "password": "P@ssw0rd!",
  "preferences": ["ì¹´í˜", "ì•¼ê²½"]
}
```

**ë¡œê·¸ì¸ ì‘ë‹µ ì˜ˆì‹œ**
```json
{
  "access_token": "...",
  "token_type": "bearer",
  "user": {
    "id": "...",
    "email": "user@example.com",
    "nickname": "ë‚˜ë¹„",
    "preferences": ["ì¹´í˜"],
    "couple_id": "..."
  }
}
```

---

## 4. ì»¤í”Œ(Couples)
ê¸°ë³¸ ê²½ë¡œ: `/api/couples`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/couples/me` | í•„ìš” | ì»¤í”Œ ìš”ì•½ ë° ì´ˆëŒ€ ì½”ë“œ ì¡°íšŒ |
| POST | `/api/couples/invite` | í•„ìš” | ì´ˆëŒ€ ì½”ë“œ ì¬ìƒì„± |
| POST | `/api/couples/join` | í•„ìš” | ì´ˆëŒ€ ì½”ë“œë¡œ ì»¤í”Œì— í•©ë¥˜ |
| PATCH | `/api/couples/preferences` | í•„ìš” | ì»¤í”Œ ì„ í˜¸(íƒœê·¸/ê°ì •/ì˜ˆì‚°) ì—…ë°ì´íŠ¸ |

**í•©ë¥˜ ìš”ì²­**
```json
{
  "code": "AB12CD"
}
```

---

## 5. ì§€ë„/ì¶”ì²œ(Map)
ê¸°ë³¸ ê²½ë¡œ: `/api/map`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| POST | `/api/map/suggestions` | í•„ìš” | ìœ„ì¹˜/ê°ì •ì„ ì…ë ¥í•´ AI ê¸°ë°˜ ì¶”ì²œ ë°˜í™˜ |

**ìš”ì²­**
```json
{
  "latitude": 37.5665,
  "longitude": 126.978,
  "emotion": "ì„¤ë ˜",
  "preferences": ["ì¹´í˜", "ì•¼ê²½"],
  "location_text": "ì„œìš¸ ì¢…ë¡œêµ¬",
  "additional_context": "ë¹„ ì˜¤ëŠ” ë‚  ì‹¤ë‚´ ìœ„ì£¼"
}
```

**ì‘ë‹µ**
```json
{
  "summary": "ì„¤ë ˜ ìƒíƒœì— ë§ì¶˜ ë§ì¶¤ ì¶”ì²œì„ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.",
  "places": [ /* MongoDB ê¸°ë°˜ ì¶”ì²œ ì¥ì†Œ ëª©ë¡ */ ],
  "llm_suggestions": [ /* LangChain + Qwen2.5ê°€ ìƒì„±í•œ ì½”ìŠ¤ ì œì•ˆ */ ]
}
```

---

## 6. í”Œë˜ë„ˆ(Planner)
ê¸°ë³¸ ê²½ë¡œ: `/api/planner`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/planner/plans` | í•„ìš” | ì»¤í”Œì˜ ëª¨ë“  ë°ì´íŠ¸ í”Œëœ ì¡°íšŒ |
| POST | `/api/planner/plans` | í•„ìš” | ìƒˆ í”Œëœ ìƒì„± |
| PUT | `/api/planner/plans/{plan_id}` | í•„ìš” | í”Œëœ ìˆ˜ì • |
| DELETE | `/api/planner/plans/{plan_id}` | í•„ìš” | í”Œëœ ì‚­ì œ |

**í”Œëœ ìƒì„± ì˜ˆì‹œ**
```json
{
  "title": "ë´„ë°¤ íë§ ì½”ìŠ¤",
  "date": "2025-04-21",
  "emotion_goal": "íë§",
  "budget_range": "mid",
  "stops": [
    {"place_id": "sample-1", "place_name": "ë¶ì´Œ ì¹´í˜", "order": 1},
    {"place_id": "sample-2", "note": "ì•¼ê²½ ë³´ê¸°", "order": 2}
  ]
}
```

---

## 7. ë¶ë§ˆí¬(Bookmarks)
ê¸°ë³¸ ê²½ë¡œ: `/api/bookmarks`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/bookmarks/` | í•„ìš” | ì»¤í”Œ ë¶ë§ˆí¬ ëª©ë¡ ì¡°íšŒ |
| POST | `/api/bookmarks/` | í•„ìš” | ì¥ì†Œë¥¼ ë¶ë§ˆí¬ì— ì¶”ê°€ |
| DELETE | `/api/bookmarks/{bookmark_id}` | í•„ìš” | ë¶ë§ˆí¬ ì‚­ì œ |

---

## 8. ë°©ë¬¸/í›„ê¸°(Visits)
ê¸°ë³¸ ê²½ë¡œ: `/api/visits`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/visits/` | í•„ìš” | ìµœê·¼ ë°©ë¬¸ ê¸°ë¡ ì¡°íšŒ |
| POST | `/api/visits/checkin` | í•„ìš” | ì²´í¬ì¸ ë° ë¦¬ë·° ìƒì„± |

**ì²´í¬ì¸ ìš”ì²­**
```json
{
  "plan_id": "...",
  "place_id": "sample-1",
  "place_name": "í•œê°• ì•¼ê²½",
  "visited_at": "2025-04-01T19:30:00",
  "emotion": "ì¦ê±°ì›€",
  "tags": ["ì•¼ê²½", "í”¼í¬ë‹‰"],
  "memo": "ì•¼ê²½ì´ ì •ë§ ë©‹ì¡Œì–´ìš”",
  "rating": 4.5
}
```

---

## 9. ì±Œë¦°ì§€(Challenges)
ê¸°ë³¸ ê²½ë¡œ: `/api/challenges`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/challenges/` | í•„ìš” | ì •ì  ì±Œë¦°ì§€ ì •ì˜ + í˜„ì¬ ì§„í–‰ë„ ì¡°íšŒ |

ê° í•­ëª©ì€ `id`, `title`, `description`, `badge_icon`, `current`, `goal`, `completed`, `completed_at`ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

---

## 10. ë¦¬í¬íŠ¸(Reports)
ê¸°ë³¸ ê²½ë¡œ: `/api/reports`

| ë©”ì„œë“œ | ê²½ë¡œ | ì¸ì¦ | ì„¤ëª… |
|--------|------|------|------|
| GET | `/api/reports/monthly?month=YYYY-MM` | í•„ìš” | ì›”ê°„ í™œë™ ìš”ì•½ ë° AI ì¸ì‚¬ì´íŠ¸ ì œê³µ |

**ì‘ë‹µ ì˜ˆì‹œ**
```json
{
  "month": "2025-04",
  "visit_count": 8,
  "top_tags": ["ì¹´í˜", "ì•¼ê²½", "íë§"],
  "emotion_stats": {"ì„¤ë ˜": 3, "íë§": 2},
  "challenge_progress": [
    {"id": "night_explorer", "completed": true, "current": 3, "goal": 3, "badge_icon": "ğŸŒƒ", "title": "ë°¤ì˜ íƒí—˜ê°€", "description": "ì•¼ê²½ íƒœê·¸ ì¥ì†Œ 3ê³³ ë°©ë¬¸", "completed_at": "..."}
  ],
  "summary": "ìš”ì•½ ë¬¸ë‹¨ ..."
}
```

---

## 11. AI / LangChain
ì§€ë„ ì¶”ì²œ(`POST /api/map/suggestions`)ê³¼ ë¦¬í¬íŠ¸(`GET /api/reports/monthly`) ë‚´ë¶€ì—ì„œ LangChain + Qwen2.5 ëª¨ë¸ì„ ì‚¬ìš©í•´ ìì—°ì–´ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤. ëª¨ë¸ ì—”ë“œí¬ì¸íŠ¸ëŠ” `.env`ì˜ `LLM_BASE_URL`, `LLM_MODEL` ê°’ìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

---

í•„ìš” ì‹œ ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ ì´ ë¬¸ì„œë¥¼ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ê°±ì‹ í•´ ì£¼ì„¸ìš”.
